#!/bin/sh

tmpFile="/tmp/$(random_hash).rss_feed"

formatLine() {
    publishedEpoc="$(printf '%s' "$1" |cut -f1)"
    publishedDate=`date -j -f '%s' '+%Y-%m-%d' "$publishedEpoc"`
    now=`date '+%Y-%m-%d'`

    if [ "$(echo "$publishedDate" |cut -d ' ' -f1)" = "$now" ]; then
        symbol='$'
    else
        symbol='#'
    fi

    title="$(printf '%s' "$1" |cut -f2)"
    source="$(printf '%s' "$1" |cut -f3)"

    printf '\n%s (%s) %s\nâž¡ %s\n\n' "$symbol" "$publishedDate" "$title" "$source" >>"$tmpFile"
}

formatTitle() {
    border="=$(echo "$1" |sed 's/./=/g')="
    printf '\n %s\n%s\n\n' "$feedTitle" "$border" >>$tmpFile
}


feedTitle="$(basename "$1")"
formatTitle "$feedTitle"

sort -r "$1" |while read -r line; do formatLine "$line"; done

tmux neww -n "$feedTitle" "nvim -R $tmpFile '+/^\\$' +6"
