#!/bin/sh

if [ -n "$1" ]; then
    vault="$1"
else
    vault="$(op list vaults |jq '.[].name' |sed 's/"//g' |fzf)"
fi

if [ -z "$vault" ]; then
    echo No vault selected
    exit 1
fi

items="$(op list items --vault "$vault")"
title="$(echo "$items" |jq '.[].overview.title' |sed 's/"//g' |fzf)"

if [ -z "$title" ]; then
    echo No item selected
    exit 1
fi

uuid="$(echo "$items" |jq ".[] | select(.overview.title == \"$title\")" |jq '.uuid' |sed 's/"//g')"

item="$(op get item "$uuid" --vault "$vault")"
account="$(echo "$item" |jq '.overview.ainfo' |sed 's/"//g')"
echo "$item" |jq '.details.fields[] | select(.name == "password")' |jq '.value' |sed 's/"//g' |tr -d '\n' |pbcopy

echo "$account"
echo Password copied into clipboard!
